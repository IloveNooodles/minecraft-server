# Setup server
---
- name: setup server files
  hosts: minecraft

  tasks:
    - name: archive server files
      delegate_to: localhost
      ansible.builtin.archive:
        path:
          - ../docker-compose.yml
          - ../.env
          - ../datapacks
          - ../mods
          - ../config
        dest: "../server.tgz"
    - name: copy server zip to remote
      ansible.builtin.copy:
        src: ../server.tgz
        dest: "{{ remote_path }}"
    - name: check if world folder is supploed
      delegate_to: localhost
      stat:
        path: ../world
      register: register_name
    - name: copy world to remote
      ansible.builtin.copy:
        src: ../world
        dest: "{{ remote_path }}/data/"
      when: register_name.stat.exists
    - name: unarchive server
      ansible.builtin.unarchive:
        src: "{{ remote_path }}/server.tgz"
        dest: "{{ remote_path }}"
        remote_src: yes
